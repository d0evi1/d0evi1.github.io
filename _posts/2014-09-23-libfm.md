---
layout: post
title: libfm 1.4.2 manual 
description: 
modified: 2014-09-28
tags: [libfm]
---

本文简述下manual上的几个要点。

# 1.准备

1.下载、编译：https://github.com/srendle/libfm

2.编译出三个bin:

- libFM: the libFM tool 
- convert: a tool for converting text-files into binary format 
- transpose: a tool for transposing binary design matrices

# 2.数据格式
libsvm sparse格式：

	4 0:1.5 3:-7.9 
	2 1:1e-5 3:2 
	-1 6:1

# 3.格式转换

script下，内置了脚本。

推荐系统中，常见格式:  

	userid itemid rating

例如：Movielens 1M数据集：

	./triple_format_to_libfm.pl -in ratings.dat -target 2 -delete_column 3 -separator "::"

如果同时对训练集、测试集处理：

	./triple_format_to_libfm.pl -in train.txt,test.txt -target 2 -separator "\t"

# 4.二进制格式

二进制数据格式优点：

- 1.读取快
- 2.原始数据不能直接装进内存（太大）；二进制格式可以存在磁盘上，一部分装进内存中 （使用--cache size）
- 3.如果使用ALS 和 MCMC,可以预先计算转置矩阵

示例：将movielens数据集转换成二进制格式：

	./convert --ifile ratings.dat.libfm --ofilex ratings.x --ofiley ratings.y

生成两个文件：

- ratings.x: 设计矩阵X，即：要预测的变量X
- ratings.y: 输出target:y

推荐使用这种后缀命名法。

# 5.转置数据

对于MCMC和ALS学习，需要使用转置的设计矩阵。

- 如果使用文本格式，数据在内部会自动进行转置。
- 如果使用二进制格式，进行转置。

示例：

	./transpose --ifile ratings.x --ofile ratings.xt

# 6.train与test

## 6.1 完整参数

	-cache_size     cache size for data storage (only applicable if data is
                in binary format), default=infty
	-dim            'k0,k1,k2': k0=use bias, k1=use 1-way interactions,
                k2=dim of 2-way interactions; default=1,1,8
	-help           this screen
	-init_stdev     stdev for initialization of 2-way factors; default=0.1
	-iter           number of iterations; default=100
	-learn_rate     learn_rate for SGD; default=0.1
	-load_model     filename for reading the FM model
	-meta           filename for meta information about data set
	-method         learning method (SGD, SGDA, ALS, MCMC); default=MCMC
	-out            filename for output
	-regular        'r0,r1,r2' for SGD and ALS: r0=bias regularization,
	                r1=1-way regularization, r2=2-way regularization
	-relation       BS: filenames for the relations, default=''
	-rlog           write measurements within iterations to a file;
	                default=''
	-save_model     filename for writing the FM model
	-seed           integer value, default=None
	-task           r=regression, c=binary classification [MANDATORY]
	-test           filename for test data [MANDATORY]
	-train          filename for training data [MANDATORY]
	-validation     filename for validation data (only for SGDA)
	-verbosity      how much infos to print; default=0


## 6.2 强制参数

	-task: 分类(-task c)或回归(-task r)
	-train: 训练
	-test: 测试
	-dim: libfm的维度. k0, k1, k2.  
    	k0: {0,1}，是否使用bias: w0
    	k1: {0,1}，是否使用one-way interactions(每个变量都加上bias)
    	k2: 实数集。使用pairwise interactions所需的因子数。k表示R^(pxk)
    

示例：一个回归任务，使用bias,1-way interaction, k=8 pairwise interaction.

	./libFM -task r -train ml1m-train.libfm -test ml1m-test.libfm -dim ’1,1,8’

## 6.3 可选参数

	-out:输出。对于分类，输出为正例的概率
	-rlog:每次迭代的统计信息日志。csv格式
	-verbosity: 是否打印更详细信息。

## 6.4 高级参数

### Grouping

使用meta选项对输入变量进行group分组。用于MCMC, SGDA and ALS的grouping，定义了一个更复杂的正则结构。每个group都有独自的正则项参数。如要使用grouping，meta参数最好是文件名，行数与输入变量数（列）相同。每行为相应的输入变量指定groupid。注意：group_id必须是从0开始的数值型。

例如：一个设计矩阵的grouping文件，1）它有7列；最大id是6

	2
	2
	0
	1
	1
	1
	0

### Binary Data and Caching



【未完待续】

<img src="http://www.forkosh.com/mathtex.cgi?B(k,n,p)=C^{n}_{k}p^k(1-p)^{n-k}">

{% highlight python %}


{% endhighlight %}

## 参考

