---
layout: post
title: MomentCross介绍
description: 
modified: 2025-2-9
tags: 
---

kuaishou直播团队在《Moment&Cross: Next-Generation Real-Time Cross-Domain CTR Prediction for Live-Streaming Recommendation at Kuaishou》提出了它们的直播推荐：

# 摘要

快手作为全球领先的短视频与直播平台之一，其直播推荐相较于短视频推荐更为复杂，主要体现在：(1) 内容具有瞬时性；(2) 用户可能长时间观看导致反馈延迟；(3) 直播内容不可预测且动态变化。事实上，即使用户对主播感兴趣，也可能因实时内容吸引力不足而产生消极观看行为（如观看时长<3秒）。因此，直播推荐面临核心挑战：**如何为用户推荐恰逢其时的直播内容？**  

此外，平台主要曝光内容为短视频，其曝光量级是直播的9倍。这导致用户行为数据严重倾向于短视频，使得直播数据难以完整反映用户兴趣。由此衍生第二项挑战：**如何利用短视频行为数据优化直播推荐？**  

针对第一项挑战，我们通过数据分析发现了一个有趣现象：当直播进入高光时刻（如舞蹈片段），点击率（CTR）会显著攀升。受此启发，我们认为可通过群体用户对当前直播片段的实时行为数据，自动识别"高光时刻"。因此，我们致力于让模型快速感知实时行为，从而识别处于CTR上升阶段的直播。为实现这一目标，我们升级了数据流引擎至30秒实时上报机制，并设计了创新的**首帧掩码学习策略（Moment）**。  

针对第二项挑战，我们主要基于搜索式兴趣建模思路：先通过**通用搜索单元（GSUs）**检索用户历史短视频/直播行为，再利用**压缩搜索单元（ESUs）**进行特征提炼。此外，引入对比学习目标对齐短视频与直播的嵌入空间以增强关联性（**Cross）**。通过大量离在线实验与消融研究，我们验证了**Moment&Cross**框架的有效性。  

# **1 引言**  

近年来，快手、抖音等短视频与直播平台快速发展，吸引了大量用户并积累了庞大的活跃用户群体。在快手平台上，用户主要通过**滑动页（slide page）**浏览内容——系统会根据用户的上下滑动行为自动播放推荐内容。因此，强大的推荐系统（RecSys）[9, 10] 是服务的基础，它直接影响用户体验，决定用户接下来观看什么内容。  

相较于已被广泛研究的短视频推荐 [29, 31, 34, 39]，**直播推荐 [25]** 更具挑战性，主要源于其媒介特性：  
1. **瞬时生命周期**：短视频可长期分发，而直播内容具有临时性（平均1小时）。  
2. **长反馈延迟 [2]**：短视频平均时长约55秒，用户行为可快速上报并用于模型训练；而直播时长较长，部分高价值反馈（如用户购买虚拟礼物）可能延迟半小时才发生。  
3. **动态内容变化 [30]**：短视频始终从0秒播放，而直播内容实时变化，用户在不同时间点进入直播间可能产生截然不同的行为。  

因此，直播推荐系统需解决一个关键问题：**如何为用户推荐恰逢其时的直播内容？** 我们通过图1中的两个案例说明：  

<img alt="图片名称" src="https://picabstract-preview-ftn.weiyun.com/ftn_pic_abs_v3/c4bf99916cc14b7f996a98a2e3599d80b97ec1d40571e0423d3c45965eab51645e0d758f2753a0490ff55d7db3548edd?pictype=scale&amp;from=30113&amp;version=3.3.3.3&amp;fname=1.jpg&amp;size=750">

图1

- **才艺直播**：主播大部分时间与观众聊天或PK，偶尔展示才艺（如舞蹈）。数据分析显示，**高光时刻**（如才艺展示）的用户进入率显著提升，结束后则快速下降。  
- **游戏直播**：主播逐局进行比赛，实时观众数随比赛进程累积，比赛结束时骤降。  

无论直播类别如何，用户点击直播的动机往往是希望观看**高光时刻**，但直播内容动态变化，使得识别高光时刻极具挑战。幸运的是，基于**群体用户对当前直播片段的实时行为**（如图1中CTR趋势与用户点击行为高度同步），我们有望自动识别高光时刻：若模型能捕捉CTR上升趋势，即可通过大量正向反馈发现潜在高光片段。  

除高光时刻识别外，直播推荐还面临**数据稀疏问题**。滑动页中，短视频占比约90%，导致直播推荐系统难以充分学习用户兴趣。因此，另一项关键挑战是：**如何利用丰富的短视频行为优化直播推荐？**  

我们首先介绍系统架构（图2）。工业场景中，不同业务的数据流（data-streaming）独立部署——例如，短视频实时交互数据（长观看、点赞等）仅由短视频数据流引擎处理并生成训练样本，而直播模型只能依赖直播数据流。尽管无法直接使用短视频数据流，但通过历史存储服务 [8, 13]，直播模型可请求获取用户跨业务交互日志，并**对齐短视频与直播的嵌入空间**，从而基于短视频兴趣推荐风格相似的直播。  

<img alt="图片名称" src="https://picabstract-preview-ftn.weiyun.com/ftn_pic_abs_v3/12dd942bb44cd9f3251ea3aedc04d54c62eb6e6070674a61798306fbfea2bff220d59f7fb327ca5aa6bd155de906392f?pictype=scale&amp;from=30113&amp;version=3.3.3.3&amp;fname=2.jpg&amp;size=750">

图2

本文提出**Moment&Cross**框架，以应对上述挑战：  

1. **Moment**：  
   - 升级训练框架，将数据上报延迟从5分钟缩短至**30秒实时上报**，使模型快速感知实时行为。  
   - 设计**首帧掩码学习策略（first-only mask learning）**，强化模型对CTR上升趋势的捕捉能力。  
2. **Cross**：  
   - 采用**级联搜索式兴趣建模 [24]**：  
     - **通用搜索单元（GSUs）**：检索用户终身历史，筛选出百量级相关条目。  
     - **精确搜索单元（ESUs）**：通过序列池化 [15] 或目标物品注意力 [37] 压缩序列信息。  
   - 引入**对比学习目标 [3]**，对齐短视频与直播嵌入空间，增强关联性。  

**本文贡献如下：**  
- 提出实时学习框架，自动发现高光直播，推动下一代直播推荐技术发展。  
- 设计轻量高效的方法，实现短视频兴趣向直播推荐的迁移。  
- 通过大量离在线实验验证Moment&Cross的有效性，该方案已部署于快手直播服务，覆盖**4亿用户**。

# **2 快手直播中的Moment&Cross框架**  

工业界CTR预测模型[14]的训练流程包含两个核心组件：  
1. **数据流引擎**：组织训练样本的特征与标签；  
2. **基于多任务学习[23]的模型**：拟合真实用户交互（如点击、点赞、长观看等）。  

本节首先回顾传统**5分钟快慢窗口（Fast-Slow）直播数据流引擎**与CTR预测模型的训练范式，随后介绍我们创新的**30秒实时数据流引擎**及其**首帧掩码学习策略**，最后阐述跨域建模技术如何捕捉用户的**长短期短视频兴趣**。  

## **2.1 基础架构：5分钟快慢窗口数据流**  

数据流引擎作为推荐系统的基石，传统方案需等待用户完全消费内容（如看完短视频或听完歌曲）后上报行为日志。该方案对短视频服务足够实时（用户平均1分钟内退出），但直播场景中用户可能观看30分钟甚至更久，若仅依赖退出时上报，模型训练将严重滞后。  

因此，业界直播数据流引擎普遍采用**固定时间窗口**（如5分钟）上报特征与标签。然而，直播用户行为的时间分布差异极大，部分高价值交互（如观看半小时后打赏）在小窗口内难以捕捉。为此，我们设计**快慢窗口机制**（图3）以平衡实时性与完整性：  

<img alt="图片名称" src="https://picabstract-preview-ftn.weiyun.com/ftn_pic_abs_v3/6c61a25b0ca1dfb9858fbf9952d6495c5c7901d4c4deafa1b77121e78659d780aafab01b4ec685bd9a20aa5ac538e575?pictype=scale&amp;from=30113&amp;version=3.3.3.3&amp;fname=3.jpg&amp;size=750">

图3

- **快窗口（5分钟）**：上报所有观测到的正负样本，保障训练时效性；  
- **慢窗口（1小时）**：仅补报快窗口中遗漏的正样本，修正标签偏差；  
- **忽略窗口**：超时后不再上报任何标签。  

统计显示，多数用户观看时长不足1小时，因此我们将观看过程划分为三个阶段监控行为：  

| 窗口类型   | 上报内容                          | 目标               |  
|------------|-----------------------------------|--------------------|  
| 5分钟快窗口 | 所有正/负样本（如点击、退出）     | 快速更新模型       |  
| 1小时慢窗口 | 快窗口中遗漏的正样本（如延迟打赏） | 修正长期行为偏差   |  
| 忽略窗口   | 无上报                            | 避免过时数据干扰   |  

该方案虽能缓解长尾行为缺失问题，但**5分钟延迟仍不足以捕捉直播高光时刻的CTR瞬变**。例如，才艺表演的高点击率可能在1分钟内达到峰值，而传统引擎需等待多个窗口周期才能响应。

### 2.2 理论基础：基于正样本未标注学习的CTR模型训练

从广义上讲，点击率预测（CTR）模型[36]作为推荐系统[26]的最终环节（又称全排序模型[38]），需要同时预测用户对候选内容的多种交互概率：
- 点击率（CTR）
- 长观看率（LVTR）
- 点赞率（LTR）  
- 评论率（CMTR）

这些预测概率通过加权计算生成最终排序得分：
$$
Ranking\_Score = (1 + \hat{y}_{ctr})^\alpha * (1 + \hat{y}_{lvtr})^\beta * (1 + \hat{y}_{ltr})^\gamma * ...
$$
其中$\alpha,\beta,\gamma$为调节各行为权重的超参数。

#### 模型架构
1. **输入特征**：
   - 用户/直播ID、统计特征
   - 历史交互序列
   - 多模态嵌入特征[1,4]（共$n>400$维）
   - 特征嵌入表示：$\mathbf{V} = [\mathbf{v}_1, \mathbf{v}_2, ..., \mathbf{v}_n]$

2. **多任务预测**：
   $$
   [\hat{y}_{ctr}, \hat{y}_{lvtr}, \hat{y}_{ltr}, ...] = f_\theta(\mathbf{V})
   $$
   其中$f_\theta(\cdot)$可采用MMoE[22]或PLE[28]等多任务结构

#### 训练策略
1. **5分钟快数据流**：使用标准交叉熵损失
   $$
   \mathcal{L}_{fast} = -\sum_{xtr} \left[ y^{xtr} \log(\hat{y}^{xtr}) + (1-y^{xtr}) \log(1-\hat{y}^{xtr}) \right]
   $$

2. **1小时慢数据流**：采用正样本未标注损失[11,18,19]修正假阴性样本
   $$
   \mathcal{L}_{slow} = -\sum_{missing} \left[ \log(\hat{y}^{xtr}) - \log(1-\hat{y}^{xtr}) \right]
   $$

### 2.3 Moment方案：30秒实时数据流与首事件掩码学习

#### 现有方案局限
1. **标签覆盖不全**：5分钟窗口会遗漏延迟行为（如打赏）
2. **实时性不足**：难以捕捉CTR瞬时上升趋势

#### 30秒实时方案改进
1. **上报机制**：
   - 正向行为实时上报（30秒内）
   - 负向行为在用户退出时上报

2. **首事件掩码策略**：
   $$
   \mathcal{L}_{moment} = -\sum_{xtr}^{first,exit} \left[ y^{xtr} \log(\hat{y}^{xtr}) + (1-y^{xtr}) \log(1-\hat{y}^{xtr}) \right]
   $$
   其中：
   - $first$：每种行为的首次正样本
   - $exit$：退出时的最终标签

#### 技术优势
1. 数据量仅增加约2倍（依赖稀疏行为数量）
2. 避免以下问题：
   - 假阴性标签（通过延迟上报负样本）
   - 重复上报（通过首事件掩码）
   - 行为预测偏差（模型拟合全局分布）

### 2.4 Cross方案：短视频兴趣迁移

#### 问题背景与系统架构
在快手推荐页的流量分布中，短视频与直播内容呈现9:1的曝光比例。由于业务模型的数据隔离性，直播推荐系统仅能使用用户直播行为数据进行监督训练。我们通过构建**跨业务历史交互存储服务**，实现了用户短视频行为向直播推荐的迁移，具体架构包含：
1. **行为日志存储**：记录用户最新10,000条观看记录，包含：
   - 内容ID
   - 时间间隔
   - 多模态标签
   - 交互标签

2. **级联式兴趣建模**：
   ```mermaid
   graph TD
   A[原始行为序列] --> B[通用搜索单元GSUs]
   B --> C[精搜单元ESUs]
   C --> D[跨域兴趣对齐]
   ```

#### 通用搜索单元(GSUs)设计
我们设计了五类搜索策略：

| 搜索单元类型 | 数学表示 | 维度 | 功能描述 |
|-------------|---------|-----|---------|
| 短期短视频GSU | $\mathbf{V}_{short} \in \mathbb{R}^{L \times D}$ | $L$=数百条 | 捕捉用户近期兴趣 |
| 点积长期短视频GSU | $\mathbf{V}_{long} \in \mathbb{R}^{L \times D}$ | $D$=嵌入维度 | 通过嵌入相似度匹配直播候选 |
| 作者ID硬搜索GSU | $\mathbf{V}_{aidhard} \in \mathbb{R}^{L \times D}$ |  | 精确匹配同作者历史内容 |
| 混合长短视频GSU | $\mathbf{V}_{mixed} \in \mathbb{R}^{L \times D}$ |  | 融合长观看行为的跨域兴趣 |

#### 跨域对齐与精搜
1. **对比学习目标**：
   $$
   \mathcal{L}_{cl}^{short} = \text{Contrastive}\left(\text{L2}(\text{Mean}(\mathbf{V}_{mixed})), \text{L2}(\text{Mean}(\mathbf{V}_{short}))\right)
   $$
   其中：
   - $\text{Mean}(\cdot): \mathbb{R}^{L \times D} \rightarrow \mathbb{R}^D$为序列池化函数
   - $\text{L2}(\cdot)$为归一化函数
   - 通过混合序列$\mathbf{V}_{mixed}$作为锚点实现多序列空间对齐

2. **目标注意力精搜(ESU)**：
   $$
   \mathbf{V}_{ESU}^\cdot = \text{target-item-attention}(\mathbf{V}_{live}\mathbf{W}_q, \mathbf{V}^\cdot\mathbf{W}_k, \mathbf{V}^\cdot\mathbf{W}_v)
   $$
   其中$\mathbf{V}_{live}$包含直播侧特征（标签、直播ID、作者ID等）

#### 技术优势
1. 通过混合序列桥接短视频与直播行为空间
2. 多粒度搜索策略覆盖长/短期、精确/泛化兴趣
3. 对比学习缓解跨域数据分布差异

### 3 实验验证

#### 3.1 基准模型与评估指标
我们基于工业级排序模型框架（图4）进行实验验证，主要组件包括：

<img alt="图片名称" src="https://picabstract-preview-ftn.weiyun.com/ftn_pic_abs_v3/4939cbaee55db7072e83fd2edf71e7d211c1dd7d439db740a9308b902bc0606dc96de0a97c05a39edcae17cb2433d9fe?pictype=scale&amp;from=30113&amp;version=3.3.3.3&amp;fname=4.jpg&amp;size=750">

图4

1. **多任务学习架构**：对比MMoE[22]、CGC[28]、PLE[28]等模型
2. **评估体系**：
   - 离线指标：AUC、GAUC（用户分组AUC）[37]
   - 在线指标：观看时长、礼物金额、点击率等
3. **测试平台**：快手主站与快手极速版A/B测试系统

#### 3.2 整体性能分析
表2显示Moment&Cross方案的性能提升：

| 模型变体       | AUC提升 | GAUC提升 | 关键发现 |
|----------------|---------|----------|---------|
| PLE(Moment&Cross) | +0.15%  | +0.12%   | 双层架构效果优于单层CGC |
| 移除短期短视频GSU | -0.9%   | -0.8%    | 短视频行为贡献最大增益 |

**核心结论**：
1. 实时数据流（Moment）使点击率提升1.63%/0.64%（主站/极速版）
2. 跨域迁移（Cross）带来观看时长2.27%/2.48%增长，礼物金额提升6.91%/8.91%
3. 低付费用户群体改善最显著（观看时长+4.13%），验证数据稀疏缓解效果

#### 3.3 在线A/B测试
表3展示关键指标变化：

| 指标         | 主站提升 | 极速版提升 | 用户群体差异 |
|--------------|---------|------------|-------------|
| 观看时长     | +4.13%  | +1.85%     | 低活跃用户>高活跃用户 |
| 礼物金额     | -0.55%  | -1.22%     | 波动在合理范围内 |
| 点击率       | +1.63%  | +0.64%     | 全量用户正向增长 |

#### 3.4 案例研究

<img alt="图片名称" src="https://picabstract-preview-ftn.weiyun.com/ftn_pic_abs_v3/5d3e1f882ede9b959332a237e0df5a0a47fbcc1cb6dac616426f246456aca8c6b5cdc26a7611928735e039ba4979bb76?pictype=scale&amp;from=30113&amp;version=3.3.3.3&amp;fname=5.jpg&amp;size=750">

图5

1. **高光时刻捕捉**（图5a）：
   - 才艺主播的舞蹈片段推荐比例提升23%
   - CTR峰值检测延迟从5分钟缩短至30秒

2. **跨域兴趣迁移**（图5b）：
   - 钓鱼短视频观看用户匹配户外钓鱼直播的准确率提升37%
   - 小众品类直播曝光量增加2.1倍

3. **用户激活效果**（表4）：
   ```mermaid
   pie
       title 低活跃用户行为提升
       "点击率" : -1.45%
       "长观看率" : -1.79%
       "礼物行为" : -1.47%
   ```
   注：负增长源于实验组扩大直播观看人群导致的相对比例变化

#### 系统影响
1. 已部署服务4亿用户，日均处理千亿级请求
2. 主播收入分位数提升：
   - 腰部主播：+12.7%
   - 尾部主播：+18.3%  
3. 用户观看时长分布更均衡（基尼系数下降0.04）

### 4 相关研究

近年来直播推荐领域涌现出多项重要工作，我们将其归类为三大研究方向：

#### 4.1 直播特有机制建模
1. **用户-作者关系建模**  
   - LiveRec[25]：首次采用自注意力机制捕捉用户与主播的重复消费关系
   - MMBee[17]：通过图表示学习构建用户-作者-作者的多跳关系网络

2. **动态内容适应**  
   - Sliver[21]：设计重推荐机制应对直播内容动态变化
   - [12]：提出基于观看时长的损失重加权策略

3. **多模态特征融合**  
   ```mermaid
   graph LR
   A[文本信息] --> C[内容理解]
   B[视频帧] --> C
   C --> D[CTR预测]
   ```
   - MTA[30]：多模态时序注意力模型
   - ContentCTR[16]：实时画面特征提取框架

#### 4.2 跨域推荐技术
| 方法        | 核心技术                     | 局限性                     |
|-------------|----------------------------|---------------------------|
| DIAGAE[35]  | 领域自适应对齐               | 仅处理表征层面迁移         |
| eLiveRec[32]| 解耦编码器（共享/专属意图）   | 依赖电商场景特定数据       |

#### 4.3 本文创新对比
1. **时序感知推荐**  
   - 现有方案：依赖固定时间窗口（如5分钟统计）
   - Moment方案：30秒实时数据流 + 首事件掩码学习

2. **跨域兴趣迁移**  
   - 传统方法：表征对齐（如C2DSR）
   - Cross方案：五层级联搜索架构（GSUs+ESUs）  
   $$ \mathcal{L}_{align} = \sum_{i=1}^5 \text{Contrastive}(\mathbf{V}_{mixed}, \mathbf{V}_i) $$

3. **系统工程创新**  
   - 首次实现直播与短视频行为流30秒级实时联动
   - 支持10,000量级历史行为序列的毫秒级检索

**技术演进路线**：从静态推荐（LiveRec）→ 动态适应（Sliver）→ 跨域融合（本文）


# 

[https://arxiv.org/pdf/2502.09869](https://arxiv.org/pdf/2502.09869)